<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <style>
        ul,
        li {
            list-style: none;
        }

        .container {
            width: 600px;
            margin: 0 auto;
        }

        .container li {
            float: left;
            margin: 10px 10px;
        }

        .container li img {
            width: 240px;
            height: 180px;
        }

        p {
            float: left;
        }
    </style>
</head>

<body>
    <ul class="container">
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
    </ul>

    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script>
    /*
    1. 对于所有的 img 标签，把真实地址放在自定义属性 data-src 内
    2. 当滚动页面时，检查所有的 img 标签，看这个标签是否出现在我们视野内，当出现时，再判断是否加载过，没有加载过再去加载

    3. 性能问题
        当用户停止滚动后，再去渲染页面，避免多次渲染

    */


    // 用户打开页面先进行一次渲染
    lazyRender ()

    let timer = null
    // 滚动页面时再判断渲染
    $(window).on('scroll',function () {
        if(timer){
            clearTimeout(timer)
        }
        timer = setTimeout(function () {
            lazyRender ()
            console.log('tian')
        },300)

    })


    // 渲染页面
    function lazyRender () {
        // 遍历页面上的所有图片，经过两次判断，当图片出现在页面中，并且没有加载过，再去加载图片
        $('.container img').each(function () {
            if(checkShow($(this)) && !isLoaded($(this))){
                loadImg($(this))
            }
        })
    }


    // 判断是否出现在视野中
    function checkShow($img){
        // 滚动的高度scrollTop，窗口的高度$(window).height()，元素的偏移位置 img.offset().top
        // 页面滚动距离
        let scrollTop = $(window).scrollTop()
        // 窗口的高度
        let windowHeight = $(window).height()
        // 图片距离定位父级的顶部距离
        let offsetTop = $img.offset().top

        if(offsetTop < scrollTop + windowHeight && offsetTop > scrollTop){
            return true
        }

    }


        // 图片是否加载过
        function isLoaded($img){
            // 判断img的data-src是否和src相等
            return $img.attr('data-src') === $img.attr('src')

        }

        // 加载图片
        function loadImg($img){
            // 把img的data-src的值放在src中
            $img.attr('src',$img.attr('data-src'))
        }

    </script>
</body>

</html>
