<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <style>
        ul,
        li {
            list-style: none;
        }

        .container {
            width: 600px;
            margin: 0 auto;
        }

        .container li {
            float: left;
            margin: 10px 10px;
        }

        .container li img {
            width: 240px;
            height: 180px;
        }

        p {
            float: left;
        }
    </style>
</head>

<body>
    <ul class="container">
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" /></a></li>
        <li><a href="#"><img id=a src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" /></a></li>
        <li><a href="#"><img id=b src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" /></a></li>
        <li><a href="#"><img src="http://img.zcool.cn/community/01e9875542c6380000019ae955160b.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" /></a></li>
    </ul>
    <p id="sign">hello</p>
    <p id="sign2">hello</p>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script>
        /*
                1. 对于所有的 img 标签，把真实地址放在自定义属性 data-src 内
                2. 当滚动页面时，检查所有的 img 标签，看这个标签是否出现在我们视野内，当出现时，再判断是否加载过，没有加载过再去加载

                3. 性能问题
                    当用户停止滚动后，再去渲染页面，避免多次渲染

                */

        // 要求：当hello显示在页面上时，把 hello变成 hello tian

        function Exposure($target, callback) {
            this.$target = $target
            this.callback = callback
            this.init()
            this.bind()
        }

        Exposure.prototype.init = function() {
            // 用户打开页面先进行一次渲染
            this.lazyRender()
            this.timer = null
        }

        Exposure.prototype.bind = function() {
            let _this = this
            // 滚动页面时再判断渲染
            $(window).on('scroll', function() {
                if (_this.timer) { clearTimeout(_this.timer) }
                _this.timer = setTimeout(function() {
                    _this.lazyRender()
                }, 300)
            })
        }

        Exposure.prototype.lazyRender = function() {
            if (this.checkShow(this.$target)) {
                this.callback(this.$target)
            }
        }

        Exposure.prototype.checkShow = function() {
            // 滚动的高度scrollTop，窗口的高度$(window).height()，元素的偏移位置 img.offset().top
            // 页面滚动距离
            let scrollTop = $(window).scrollTop()
            // 窗口的高度
            let windowHeight = $(window).height()
            // 图片距离定位父级的顶部距离
            let offsetTop = this.$target.offset().top

            if (offsetTop < scrollTop + windowHeight && offsetTop > scrollTop) {
                return true
            }
        }

        // new Exposure($('#sign'),function (node) {
        //     $(node).text(11)
        // })
        // new Exposure($('#sign2'),function (node) {
        //     $(node).text(22)
        // })
        //
        // // 图片懒加载
        // $('.container img').each(function (indx,img) {
        //     new Exposure($(img),function ($img) {
        //         if (!isLoaded($img)) {
        //             loadImg($img)
        //         }
        //     })
        // })




        let lazy = (function () {
            return {
                init: function ($targets, callback) {
                    $targets.each(function (indx,target) {
                        new Exposure($(target),callback)
                    })
                }
            }
        })()

        lazy.init($('#sign'),function (node) {
            $(node).text(11)
        })
        lazy.init($('#sign2'),function (node) {
             $(node).text(22)
        })
        lazy.init($('.container img'),function (node) {
            if (!isLoaded(node)) {
             loadImg(node)
            }
        })



        // 图片是否加载过
        function isLoaded($img) {
            // 判断img的data-src是否和src相等
            return $img.attr('data-src') === $img.attr('src')
        }

        // 加载图片
        function loadImg($img) {
            // 把img的data-src的值放在src中
            $img.attr('src', $img.attr('data-src'))
        }

    </script>
</body>

</html>
